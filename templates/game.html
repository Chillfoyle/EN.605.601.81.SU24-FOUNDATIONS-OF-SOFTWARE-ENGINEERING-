<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Trivial Compute Game</title>
    <style>
        .game-board {
            width: 450px; /* Total width of the board */
            height: 450px; /* Total height of the board */
            display: grid;
            grid-template-columns: repeat(9, 1fr); /* 9 columns */
            grid-template-rows: repeat(9, 1fr); /* 9 rows */
            border: 2px solid black;
        }

        .square {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            border: 1px solid black;
        }

        .square-empty {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
        }

        .red { background-color: red; }
        .green { background-color: green; }
        .blue { background-color: blue; }
        .yellow { background-color: yellow; }
        .white { background-color: white; }

        .dice {
            width: 50px;
            height: 50px;
            background-color: white;
            border: 2px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            margin-top: 10px;
        }

        .button {
            background-color: rgb(0, 170, 255);
            border: none;
            color: white;
        }

        #players-list {
            list-style-type: none;
            padding: 0;
        }


        #players-list li {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1 style="color:rgb(0, 170, 255)";>Trivial Compute Game</h1>
    <script>
        let players = [];

        // Function to simulate rolling dice visually
        function rollDice() {
            const diceElement = document.getElementById('dice');
            diceElement.textContent = 'Rolling...';
            
            setTimeout(() => {
                const diceRoll = Math.floor(Math.random() * 6) + 1; // Roll dice from 1 to 6
                diceElement.textContent = diceRoll;
                document.getElementById('last-roll').textContent = diceRoll;
            }, 1000); // Simulate dice roll delay for 1 second
        }

        function fetchQuestion() {
            let category = document.getElementById('category').value;
            let url = '/get_question';
            if (category) {
                url += '?category=' + category;
            }

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('question').innerText = data.question;
                    sessionStorage.setItem('currentAnswer', data.answer);
                })
                .catch(error => console.error('Error:', error));
        }


        function checkAnswer() {
            let userAnswer = document.getElementById('answer').value.trim();
            let correctAnswer = sessionStorage.getItem('currentAnswer');
            let currentPlayer = getCurrentPlayer();


            if (!userAnswer) {
                alert('Please enter your answer.');
                return;
            }

            if (userAnswer.toLowerCase() === correctAnswer.toLowerCase()) {
                alert('Correct!');
                increaseScore(currentPlayer);
            } 
            else {
                alert('Incorrect. The correct answer is: ' + correctAnswer);
                nextPlayerTurn();
            }


            fetchQuestion();  // Fetch next question regardless of correct or incorrect
            document.getElementById('answer').value = '';  // Clear answer input field
        }

        function increaseScore(player) {
            player.score++;
            updatePlayerScores();
        }

        function getCurrentPlayer() {
            return players.find(player => player.current);
        }

        function nextPlayerTurn() {
            let currentPlayerIndex = players.findIndex(player => player.current);
            players[currentPlayerIndex].current = false;
            if (currentPlayerIndex === players.length - 1) {
                players[0].current = true;  // Move to first player if last player's turn
            } else {
                players[currentPlayerIndex + 1].current = true;
            }
            updatePlayerTurnIndicator();
        }

        function updatePlayerTurnIndicator() {
            let currentPlayer = getCurrentPlayer();
            document.getElementById('current-player').innerText = currentPlayer.name;
            updatePlayerScores();
        }

        function updatePlayerScores() {
            let playersList = document.getElementById('players-list');
            playersList.innerHTML = '';
            players.forEach(player => {
                let listItem = document.createElement('li');
                listItem.innerText = `${player.name}: ${player.score} ${player.current ? '(Current Player)' : ''}`;
                playersList.appendChild(listItem);
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            // Prompt for adding players
            let numPlayers = prompt('Enter number of players (1 to 4):');
            if (numPlayers && numPlayers >= 1 && numPlayers <= 4) {
                for (let i = 0; i < numPlayers; i++) {
                    let playerName = prompt(`Enter name for Player ${i + 1}:`);
                    if (playerName) {
                        fetch('/add_player', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ name: playerName })
                        })
                        .then(response => response.json())
                        .then(data => {
                            alert(data.message);
                            players.push({ name: playerName, score: 0, current: false });
                            if (players.length === 1) {
                                players[0].current = true;  // First player starts as current player
                                document.getElementById('current-player').innerText = playerName;
                            }
                            updatePlayerScores();
                        })
                        .catch(error => console.error('Error:', error));
                    }
                }
            } else {
                alert('Invalid number of players. Game requires 1 to 4 players.');
                window.location.href = '/';  // Reload the page to restart
            }

            fetchQuestion();
            document.getElementById('add-question-form').addEventListener('submit', function (event) {
                event.preventDefault();
                let newQuestion = document.getElementById('new-question').value.trim();
                let newAnswer = document.getElementById('new-answer').value.trim();
                let newCategory = document.getElementById('new-category').value;


                if (newQuestion && newAnswer && newCategory) {
                    fetch('/add_question', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ question: newQuestion, answer: newAnswer, category: newCategory })
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert(data.message);
                        document.getElementById('add-question-form').reset();
                        fetchQuestion();  // Fetch next question after adding new question
                    })
                    .catch(error => console.error('Error:', error));
                } else {
                    alert('Please enter both question, answer, and select a category.');
                }
            });
        });
    </script>


    <div id="player-info">
        <h2 style="color:rgb(0, 170, 255);">Players:</h2>
        <ul id="players-list">
            <!-- Player names will be dynamically added here -->
        </ul>
        <p>Current Player: <span id="current-player"></span></p>
    </div>


    <div id="player-actions">
        <h2></h2>
        <div class="dice" id="dice">-</div>
        <button class="button" onclick="rollDice()">Roll Dice</button>
    </div>


    <!-- <div id="game-board"> -->
    <div class="game-board">
        <!-- TODO: replace these squares by buttons with actions. -->
        <!-- Display game board, player tokens, etc. -->
        <!-- First row -->
        <div class="square white"></div>
        <div class="square yellow"></div>
        <div class="square blue"></div>
        <div class="square green"></div>
        <div class="square red"></div>
        <div class="square yellow"></div>
        <div class="square blue"></div>
        <div class="square green"></div>
        <div class="square white"></div>


        <!-- Second row -->
        <div class="square red"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square yellow"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square red"></div>


        <!-- Third row -->
        <div class="square green"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square blue"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square yellow"></div>


        <!-- Fourth row -->
        <div class="square blue"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square green"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square blue"></div>


        <!-- Fifth row -->
        <div class="square yellow"></div>
        <div class="square blue"></div>
        <div class="square green"></div>
        <div class="square red"></div>
        <div class="square white"></div>
        <div class="square blue"></div>
        <div class="square yellow"></div>
        <div class="square red"></div>
        <div class="square green"></div>


        <!-- Sixth row -->
        <div class="square red"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square yellow"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square red"></div>




        <!-- Seventh row -->
        <div class="square green"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square red"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square yellow"></div>




        <!-- Eighth row -->
        <div class="square blue"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square green"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square-empty white"></div>
        <div class="square blue"></div>




        <!-- Ninth row -->
        <div class="square white"></div>
        <div class="square yellow"></div>
        <div class="square red"></div>
        <div class="square green"></div>
        <div class="square blue"></div>
        <div class="square yellow"></div>
        <div class="square red"></div>
        <div class="square green"></div>
        <div class="square white"></div>


    </div>


    <!-- FIXME1:
    <div id="question-window">
        <h2>{{ game_state.current_question }}</h2>
        <form id="answer-form">
            {% for answer in game_state.answers %}
                <input type="radio" name="answer" value="{{ answer }}"> {{ answer }}<br>
            {% endfor %}
            <button type="submit">Submit Answer</button>
        </form>
    </div>
    -->


    <!-- Delete this when FIXME1 gets resolved-->
    <div id="question-container">
        <!-- <h1 style="color:rgb(0, 170, 255);">...???...</h1> -->
        <p id="question"></p>
        <input type="text" id="answer" placeholder="Your Answer">
        <select id="category">
            <option value="">All Categories</option>
            <option value="yellow">Yellow</option>
            <option value="green">Green</option>
            <option value="red">Red</option>
            <option value="blue">Blue</option>
        </select>
        <button class="button" onclick="fetchQuestion()">Next Question</button>
        <button class="button" onclick="checkAnswer()">Submit Answer</button>
    </div>
</body>
</html>
